{% extends "base.html" %}

{% block crud_container %}
<article class="card container fluid">
    <div class="d-flex bd-highlight mb-3">
        <div class="me-auto p-3 bd-highlight fs-4">{{ book.author }}: {{ book.title }}</div>
        {% if book.user_id == current_user.id %}
            <div class="btn-group">
            <a href="/book/{{ book.id }}/edit" class="btn btn-outline-secondary d-flex align-items-center" >‚úèÔ∏è</a>
            <!-- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º -->
            <button type="button" class="btn btn-outline-danger"
                    onclick="confirmDelete({{ book.id }}, '{{ book.title }}')">üóë</button>
            </div>
        {% else %}
        <!--
          <div class="p-2 bd-highlight">
            <a href="/library/join" class="btn btn-success">üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</a>
          </div>
        -->
        {% endif %}
    </div>

    <div class="row">
        <!-- –õ–µ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–Ω–∏–≥–µ</h5>
                    <table class="table table-borderless">
                        <tr>
                            <td class="fw-bold" style="width: 40%;">–°—Ç–∞—Ç—É—Å –ø—Ä–æ—á—Ç–µ–Ω–∏—è:</td>
                            <td>{{ book.read_status.russian_name }}</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">–ñ–∞–Ω—Ä</td>:
                            <td>{{ book.genre }}</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">–û–ø–∏—Å–∞–Ω–∏–µ:</td>
                            <td>{{ book.description or "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è" }}</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">–¶–≤–µ—Ç –æ–±–ª–æ–∂–∫–∏:</td>
                            <td><div class="book-color">
                                <span class="color-visual" style="background-color: {{ book.color }};"></span>
                            </div></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h5>
                    <table class="table table-borderless">
                        <tr>
                            <td class="fw-bold" style="width: 40%;">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:</td>
                            <td>{{ book.lib_address }}</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">–ö–æ–º–Ω–∞—Ç–∞</td>:
                            <td>{{ book.room or "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è" }}</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">–ü–æ–ª–∫–∞:</td>
                            <td>{{ book.shelf or "–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è" }}</td>
                        </tr>
                        <tr>
                            <td class="fw-bold">–î–æ–±–∞–≤–ª–µ–Ω–∞:</td>
                            <td>{{ user.username }}</td>
                        </tr>
                    </table>
                </div>
            </div>

        </div>

    </div>
    <br>
    <div class="d-flex justify-content-center">
        <a href="/book" class="btn btn-success">–ö —Å–ø–∏—Å–∫—É –∫–Ω–∏–≥</a>
    </div>
    <br>
</article>

<!-- ‚úÖ Modal –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-dark">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-dark">
        <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É <strong id="book-title"></strong>?</p>
          <p class="text-danger">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          –û—Ç–º–µ–Ω–∞
        </button>
        <form id="deleteForm" method="post" style="display:inline;">
          <button type="submit" class="btn btn-danger">
            –£–¥–∞–ª–∏—Ç—å
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
.book-color {
  display: flex;
  align-items: center;
  gap: 8px;
}

.color-visual {
  width: 25px;
  height: 25px;
  border-radius: 10px;
  border: 1px solid #dee2e6;
  display: inline-block;
}

/* –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —Å–∫—Ä—ã–≤–∞–µ–º –∫–æ–¥ */
@media (max-width: 768px) {
  .color-code {
    display: none;
  }
}
</style>

<script>
function confirmDelete(bookId, bookTitle) {
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏
  document.getElementById('book-title').textContent = bookTitle;

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º action —Ñ–æ—Ä–º—ã
  document.getElementById('deleteForm').action = `/book/${bookId}/delete`;

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º modal
  const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
  modal.show();
}
</script>

{% endblock %}