{% extends "base.html" %}

{% block crud_container %}
<div class="row justify-content-center">
  <div class="col-md-8">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title text-dark">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥—É</h3>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∞–≤–∞—Ö -->
        {% if not permissions.can_edit_full %}
        <div class="alert alert-info">
          <small>
            üîí –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞—Ü–∏—é –∏ —Å—Ç–∞—Ç—É—Å —á—Ç–µ–Ω–∏—è. <br>
            –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—é –∫–Ω–∏–≥–∏ –∏–ª–∏ –≤–ª–∞–¥–µ–ª—å—Ü—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
          </small>
        </div>
        {% endif %}

        <form action="/book/{{ book.id }}/edit" method="post">
          <input type="hidden" name="back_url" value="{{ back_url }}">
          <div class="row">
            <!-- –ê–≤—Ç–æ—Ä -->
            <div class="col-md-6 mb-3">
              <label class="form-label text-dark">–ê–≤—Ç–æ—Ä*</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="author" class="form-control"
                     value="{{ book.author }}" required>
              {% else %}
              <div class="form-control bg-light">
                {{ book.author }}
                <input type="hidden" name="author" value="{{ book.author }}">
              </div>
              <small class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</small>
              {% endif %}
            </div>

            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
            <div class="col-md-6 mb-3">
              <label class="form-label text-dark">–ù–∞–∑–≤–∞–Ω–∏–µ*</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="title" class="form-control"
                     value="{{ book.title }}" required>
              {% else %}
              <div class="form-control bg-light">
                {{ book.title }}
                <input type="hidden" name="title" value="{{ book.title }}">
              </div>
              <small class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</small>
              {% endif %}
            </div>
          </div>

          <!-- –û–ø–∏—Å–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞) -->
          <div class="mb-3">
            <label class="form-label text-dark">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            {% if permissions.can_edit_full %}
            <textarea name="description" class="form-control" rows="3"
                      placeholder="–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–Ω–∏–≥–∏...">{{ book.description or '' }}</textarea>
            {% else %}
            <div class="form-control bg-light">
              {{ book.description or '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è' }}
              <input type="hidden" name="description" value="{{ book.description or '' }}">
            </div>
            <small class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</small>
            {% endif %}
          </div>

          <div class="row">
            <!-- –ñ–∞–Ω—Ä -->
            <div class="col-md-6 mb-3">
              <label class="form-label text-dark">–ñ–∞–Ω—Ä</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="genre" class="form-control"
                     list="genre-suggestions" value="{{ book.genre or '' }}">
              <datalist id="genre-suggestions">
                {% for g in popular_genres %}
                  <option value="{{ g.genre }}">
                {% endfor %}
              </datalist>
              {% else %}
              <div class="form-control bg-light">
                {{ book.genre or '–ù–µ —É–∫–∞–∑–∞–Ω' }}
                <input type="hidden" name="genre" value="{{ book.genre or '' }}">
              </div>
              <small class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</small>
              {% endif %}
            </div>

            <!-- –°—Ç–∞—Ç—É—Å —á—Ç–µ–Ω–∏—è (–¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º) -->
            <div class="col-md-6 mb-3">
              <label class="form-label text-dark">–°—Ç–∞—Ç—É—Å —á—Ç–µ–Ω–∏—è*</label>
              <select name="read_status" class="form-select" required>
                <option value="not_read"
                        {{ 'selected' if current_read_status == 'not_read' else '' }}>
                  üìö –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
                </option>
                <option value="reading"
                        {{ 'selected' if current_read_status == 'reading' else '' }}>
                  üìñ –ß–∏—Ç–∞—é
                </option>
                <option value="read"
                        {{ 'selected' if current_read_status == 'read' else '' }}>
                  ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–æ
                </option>
              </select>
              <small class="text-muted">–ï—Å–ª–∏ –∫–Ω–∏–≥–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–∞ - –æ—Ç–º–µ—Ç—å üç∑</small>
            </div>
          </div>

          <div class="row">
          <!-- –õ–æ–∫–∞—Ü–∏—è (–¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–º) -->
          <div class="col-md-6 mb-3">
            <label class="form-label text-dark">–¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ*</label>
            <input type="text" name="location" class="form-control"
                   value="{{ book.location or '–í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ' }}" required
                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ, –ö–æ—Å—Ç—è –≤–∑—è–ª –ø–æ—á–∏—Ç–∞—Ç—å...">
            <small class="text-muted">–ï—Å–ª–∏ –∫–Ω–∏–≥–∞ —Å–µ–π—á–∞—Å —É —Ç–µ–±—è - –Ω–∞–ø–∏—à–∏ –æ–± —ç—Ç–æ–º ‚úçÔ∏è</small>
          </div>

          <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞) -->
          {% if permissions.can_edit_full %}
          <div class="col-md-6 mb-3">
            <label class="form-label text-dark">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞*</label>
            <select name="library_id" class="form-select" required>
              {% for lib in libraries %}
                <option value="{{ lib.id }}"
                        {% if lib.id == book.library_id %}selected{% endif %}>
                  {{ lib.name }}
                </option>
              {% endfor %}
            </select>
          </div>
          {% else %}
          <input type="hidden" name="library_id" value="{{ book.library_id }}">
          {% endif %}
          </div>

          <!-- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞) -->
          {% if permissions.can_edit_full %}
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label text-dark">–ê–¥—Ä–µ—Å</label>
              <input type="text" name="lib_address" class="form-control"
                     value="{{ book.lib_address or '' }}">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label text-dark">–ö–æ–º–Ω–∞—Ç–∞</label>
              <input type="text" name="room" class="form-control"
                     value="{{ book.room or '' }}">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label text-dark">–ü–æ–ª–∫–∞</label>
              <input type="text" name="shelf" class="form-control"
                     value="{{ book.shelf or '' }}">
            </div>
          </div>
          {% else %}
          <input type="hidden" name="lib_address" value="{{ book.lib_address or '' }}">
          <input type="hidden" name="room" value="{{ book.room or '' }}">
          <input type="hidden" name="shelf" value="{{ book.shelf or '' }}">
          {% endif %}

          <!-- –¶–≤–µ—Ç (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞) -->
          <div class="mb-3">
            <label class="form-label text-dark">–¶–≤–µ—Ç –æ–±–ª–æ–∂–∫–∏</label>
            {% if permissions.can_edit_full %}
            <input type="color" name="color" class="form-control form-control-color"
                   value="{{ book.color or '#3498db' }}" title="–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –æ–±–ª–æ–∂–∫–∏">
            {% else %}
            <div class="d-flex align-items-center">
              <input type="color" class="form-control form-control-color me-2"
                     value="{{ book.color or '#3498db' }}" disabled style="width: 50px;">
              <span class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</span>
              <input type="hidden" name="color" value="{{ book.color or '#3498db' }}">
            </div>
            {% endif %}
          </div>

          <div class="d-flex gap-2 justify-content-between">
            <button type="submit" class="btn btn-success">
              üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
            </button>
            <a href="/book/{{ book.id }}{% if back_url %}?back_url={{ back_url }}{% endif %}"
              class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}