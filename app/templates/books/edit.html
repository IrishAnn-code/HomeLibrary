{% extends "base.html" %}

{% block crud_container %}
<div class="row justify-content-center" xmlns="http://www.w3.org/1999/html">
  <div class="col-md-8">
    <div class="card">
      <div class="card-body">
        <h3 class="card-title text-dark">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–∏–≥—É</h3>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∞–≤–∞—Ö -->
        {% if not permissions.can_edit_full %}
        <div class="alert alert-info">
          <small>
            üîí –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å —á—Ç–µ–Ω–∏—è. <br>
            –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—é –∫–Ω–∏–≥–∏ –∏–ª–∏ –≤–ª–∞–¥–µ–ª—å—Ü—É –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
          </small>
        </div>
        {% endif %}

        <form action="/book/{{ book.id }}/edit" method="post">
          <div class="row">
            <!-- –ê–≤—Ç–æ—Ä -->
            <div class="col-md-6 mb-3">
              <label class="form-label text-dark">–ê–≤—Ç–æ—Ä*</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="author" class="form-control"
                     value="{{ book.author }}" required>
              {% else %}
              <div class="form-control bg-light">
                {{ book.author }}
                <input type="hidden" name="author" value="{{ book.author }}">
              </div>
              <small class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</small>
              {% endif %}
            </div>

            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ -->
            <div class="col-md-6 mb-3">
              <label class="form-label text-dark">–ù–∞–∑–≤–∞–Ω–∏–µ*</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="title" class="form-control"
                     value="{{ book.title }}" required>
              {% else %}
              <div class="form-control bg-light">
                {{ book.title }}
                <input type="hidden" name="title" value="{{ book.title }}">
              </div>
              <small class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</small>
              {% endif %}
            </div>
          </div>

          <!-- –û–ø–∏—Å–∞–Ω–∏–µ (–¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º) -->
          <div class="mb-3">
            <label class="form-label text-dark">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea name="description" class="form-control" rows="3"
                      placeholder="–î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–Ω–∏–≥–∏...">{{ book.description or '' }}</textarea>
            <small class="text-muted">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ</small>
          </div>

          <div class="row">
            <!-- –ñ–∞–Ω—Ä -->
            <div class="col-md-6 mb-3">
              <label class="form-label text-dark">–ñ–∞–Ω—Ä</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="genre" class="form-control"
                     list="genre-suggestions" value="{{ book.genre or '' }}">
              <datalist id="genre-suggestions">
                {% for g in popular_genres %}
                  <option value="{{ g.genre }}">
                {% endfor %}
              </datalist>
              {% else %}
              <div class="form-control bg-light">
                {{ book.genre or '–ù–µ —É–∫–∞–∑–∞–Ω' }}
                <input type="hidden" name="genre" value="{{ book.genre or '' }}">
              </div>
              <small class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</small>
              {% endif %}
            </div>

            <!-- –°—Ç–∞—Ç—É—Å —á—Ç–µ–Ω–∏—è (–¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º) -->
            <div class="col-md-6 mb-3">
              <label class="form-label text-dark">–°—Ç–∞—Ç—É—Å —á—Ç–µ–Ω–∏—è*</label>
              <select name="read_status" class="form-select" required>
                <option value="not_read" {% if book.read_status == 'not_read' %}selected{% endif %}>
                  üìö –ù–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ
                </option>
                <option value="reading" {% if book.read_status == 'reading' %}selected{% endif %}>
                  üìñ –ß–∏—Ç–∞—é
                </option>
                <option value="read" {% if book.read_status == 'read' %}selected{% endif %}>
                  ‚úÖ –ü—Ä–æ—á–∏—Ç–∞–Ω–æ
                </option>
              </select>
              <small class="text-muted">–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å —Å—Ç–∞—Ç—É—Å</small>
            </div>
          </div>

          <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞) -->
          {% if permissions.can_edit_full %}
          <div class="mb-3">
            <label class="form-label text-dark">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞*</label>
            <select name="library_id" class="form-select" required>
              {% for lib in libraries %}
                <option value="{{ lib.id }}"
                        {% if lib.id == book.library_id %}selected{% endif %}>
                  {{ lib.name }}
                </option>
              {% endfor %}
            </select>
          </div>
          {% else %}
          <input type="hidden" name="library_id" value="{{ book.library_id }}">
          {% endif %}

          <!-- –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ -->
          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label text-dark">–ê–¥—Ä–µ—Å</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="lib_address" class="form-control"
                     value="{{ book.lib_address or '' }}">
              {% else %}
              <div class="form-control bg-light">
                {{ book.lib_address or '–ù–µ —É–∫–∞–∑–∞–Ω' }}
                <input type="hidden" name="lib_address" value="{{ book.lib_address or '' }}">
              </div>
              {% endif %}
            </div>

            <div class="col-md-4 mb-3">
              <label class="form-label text-dark">–ö–æ–º–Ω–∞—Ç–∞</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="room" class="form-control"
                     value="{{ book.room or '' }}">
              {% else %}
              <div class="form-control bg-light">
                {{ book.room or '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}
                <input type="hidden" name="room" value="{{ book.room or '' }}">
              </div>
              {% endif %}
            </div>

            <div class="col-md-4 mb-3">
              <label class="form-label text-dark">–ü–æ–ª–∫–∞</label>
              {% if permissions.can_edit_full %}
              <input type="text" name="shelf" class="form-control"
                     value="{{ book.shelf or '' }}">
              {% else %}
              <div class="form-control bg-light">
                {{ book.shelf or '–ù–µ —É–∫–∞–∑–∞–Ω–∞' }}
                <input type="hidden" name="shelf" value="{{ book.shelf or '' }}">
              </div>
              {% endif %}
            </div>
          </div>

          <!-- –¶–≤–µ—Ç (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞) -->
          <div class="mb-3">
            <label class="form-label text-dark">–¶–≤–µ—Ç –æ–±–ª–æ–∂–∫–∏</label>
            {% if permissions.can_edit_full %}
            <input type="color" name="color" class="form-control form-control-color"
                   value="{{ book.color or '#3498db' }}" title="–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –æ–±–ª–æ–∂–∫–∏">
            {% else %}
            <div class="d-flex align-items-center">
              <input type="color" class="form-control form-control-color me-2"
                     value="{{ book.color or '#3498db' }}" disabled style="width: 50px;">
              <span class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è</span>
              <input type="hidden" name="color" value="{{ book.color or '#3498db' }}">
            </div>
            {% endif %}
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-success">
              üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
            </button>
            <a href="/book/{{ book.id }}" class="btn btn-secondary">‚Üê –û—Ç–º–µ–Ω–∞</a>

            <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–ª—è –∏–º–µ—é—â–∏—Ö –ø—Ä–∞–≤–∞ -->
            {% if permissions.can_delete %}
            <button type="button" class="btn btn-danger ms-auto"
                    data-bs-toggle="modal" data-bs-target="#deleteModal">
              üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É
            </button>
            {% endif %}
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è -->
{% if permissions.can_delete %}
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-dark">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body text-dark">
        <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É <strong>{{ book.title }}</strong>?</p>
        <div class="alert alert-warning mt-2">
          <small>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å</small>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <form action="/book/{{ book.id }}/delete" method="post" class="display:inline;e">
          <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}