{% extends "base.html" %}

{% block crud_container %}
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
  <div class="h3 mb-3 mb-md-0">üìö {{ library.name }}</div>

  <div class="d-flex flex-wrap gap-2 ">
    <a href="/book/create?library_id={{ library.id }}" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>
    <a href="/library/{{ library.id }}/edit" class="btn btn-outline-secondary d-flex align-items-center" >‚úèÔ∏è</a>

  </div>
</div>

{% if books_with_status %}
<div class="d-none d-lg-block">
  <div class="table-responsive rounded-3">
    <table class="table table-striped table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th>‚Ññ</th>
          <th>–ê–≤—Ç–æ—Ä</th>
          <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
          <th>–ñ–∞–Ω—Ä</th>
          <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</th>
        </tr>
      </thead>
      <tbody>
        {% for item in books_with_status %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ item.book.author }}</td>
          <td><a href="/book/{{ item.book.id }}?back_url=/library/{{ library.id }}"
                class="text-decoration-none">{{ item.book.title }}</a></td>
          <td>{{ item.book.genre }}</td>
          <td>{{ item.book.description }}</td>
          <td>
            <p class="card-text text-dark">
              <span class="badge bg-{{ 'success' if item.read_status == 'read' else 'warning' if item.read_status == 'reading' else 'secondary' }}">
                {{ item.read_status.russian_name }}</span>
            </p>
          </td>
          <td>{{ '–í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ' if item.book.lib_address == item.book.location else (item.book.location if item.book.location else '–í –±–∏–±–ª–∏–æ—Ç–µ–∫–µ') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
  <div class="alert alert-info">
    <p class="mb-0">–í —ç—Ç–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –ø–æ–∫–∞ –Ω–µ—Ç –∫–Ω–∏–≥. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>
  </div>
{% endif %}
<div class="d-flex justify-content-end">
  id: {{ library.id }}
</div>


<!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
<div class="d-block d-lg-none">  <!-- ‚úÖ –¢–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
  {% for item in books_with_status %}
  <a href="/book/{{ item.book.id }}?back_url=/library/{{ library.id }}" class="text-decoration-none">
  <div class="card mb-3">
    <div class="card-body text-dark">
      <h5 class="card-title">{{ item.book.title }}</h5>
      <p class="card-text mb-1"><strong>–ê–≤—Ç–æ—Ä:</strong> {{ item.book.author }}</p>
      {% if item.book.genre %}
      <p class="card-text mb-1"><strong>–ñ–∞–Ω—Ä:</strong> {{ item.book.genre }}</p>
      {% endif %}
      {% if item.book.description%}
       <p class="card-text mb-2">
        <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
        <small class="text-muted">{{ item.book.description|truncate(50) }}</small>
      </p>
      {% endif %}
      <p class="card-text mb-2">
        <span class="badge bg-{{ 'success' if item.read_status.value == 'read' else 'warning' if item.read_status.value == 'reading' else 'secondary' }}">
          {{ item.read_status.russian_name }}
        </span>
      </p>
    </div>
  </div>
  </a>
  {% endfor %}
</div>


<!-- ‚úÖ Modal –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
<div class="modal fade" id="deleteLibraryModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-center">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title w-100" >–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-dark">
              <div class="alert alert-danger py-3">
                  <div class="text-center fw-bold mb-1">–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ –≤—Å–µ –∫–Ω–∏–≥–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ</div>
                  <div class="text-center">
                      –í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É?
                      <div class="mt-2 p-2 bg-light rounded border">
                          <strong id="library-name-delete" class="text-danger">¬´–ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏¬ª</strong>
                      </div>
                  </div>
              </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <form id="deleteLibraryForm" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger">üóë –£–¥–∞–ª–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}